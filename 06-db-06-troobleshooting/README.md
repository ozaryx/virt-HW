# Домашнее задание к занятию "6.6. Troubleshooting"

## Задача 1

Перед выполнением задания ознакомьтесь с документацией по [администрированию MongoDB](https://docs.mongodb.com/manual/administration/).

Пользователь (разработчик) написал в канал поддержки, что у него уже 3 минуты происходит CRUD операция в MongoDB и её 
нужно прервать. 

Вы как инженер поддержки решили произвести данную операцию:
- напишите список операций, которые вы будете производить для остановки запроса пользователя
- предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB

**Ответ**

Определить текущую операцию командой:  
       db.currentOp()
Завершить операцию по opid
       db.killOp()

Из задания не понятно, какую именно операцию выполняет разработчик (Insert, Select, Update или Delete).

Если это Select, то Необходимо проанализировать запрос, и если необходимо, то построить соответствующий индекс, собрать статистики по соответствующим таблицам и индексам.

Если это Update или Delete, то необходимо детально разбираться на каком этапе происходит замедление. Если на этапе выборки строк для обновления или удаления, то возможно также необходимо создать нужный индекс, или собрать статистику. Если замеделние происходит на этапе удаления/обнолвения, то возможно причину стоит искать в нехватке памяти или в быстродействии файловой системы.

## Задача 2

Перед выполнением задания познакомьтесь с документацией по [Redis latency troobleshooting](https://redis.io/topics/latency).

Вы запустили инстанс Redis для использования совместно с сервисом, который использует механизм TTL. 
Причем отношение количества записанных key-value значений к количеству истёкших значений есть величина постоянная и
увеличивается пропорционально количеству реплик сервиса. 

При масштабировании сервиса до N реплик вы увидели, что:
- сначала рост отношения записанных значений к истекшим
- Redis блокирует операции записи

Как вы думаете, в чем может быть проблема?

**Ответ**

Проблема связана с увеличением количества истекших значений. Redis поддерживает количество истекших значений в пределах 25%. Если Redis обнаруживает, что количество истекших значений больше 25%, то Redis может блокировать запись новых значений, пока не очистит истекшие значения ниже 25%.
 
## Задача 3

Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей, в таблицах базы,
пользователи начали жаловаться на ошибки вида:
```python
InterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '
```

Как вы думаете, почему это начало происходить и как локализовать проблему?

Какие пути решения данной проблемы вы можете предложить?

## Задача 4


Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с 
большим объемом данных лучше, чем MySQL.

После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:

`postmaster invoked oom-killer`

Как вы думаете, что происходит?

Как бы вы решили данную проблему?

---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
